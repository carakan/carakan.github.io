<!DOCTYPE html>
<html>
  <head>
  <title>
      
          install passenger 5, ruby 2.x, nginx 1.10.x and enable HTTP/2 - carakan
      
  </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="map[]" />
  <link rel="shortcut icon" type="image/x-icon" href="https://carakan.github.io/img/favicon.ico">

  
  
  
  
  
  <link rel="stylesheet" href="https://carakan.github.io/style.min.a6cab246517742ad1189b209575fc61556550e663cdfe02a0aab0632b39e978b.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

  
  

  <meta property="og:title" content="install passenger 5, ruby 2.x, nginx 1.10.x and enable HTTP/2" />
<meta property="og:description" content="Recently I found that passenger in the last version now uses nginx 1.10.x by default, as you knows since nginx 1.9.x nginx enables support for http2 but the 1.9.x on nginx is beta and when released the line 1.10 is production ready. The process will be describe for ubuntu 14.4 and 16.4:
Install Dependencies apt-get update -y apt-get upgrade -y apt-get install sudo -y install the required packages:
sudo apt-get install -y build-essential zlib1g-dev libyaml-dev libssl-dev libgdbm-dev libreadline-dev libncurses5-dev libffi-dev curl openssh-server checkinstall libxml2-dev libxslt-dev libcurl4-openssl-dev libicu-dev logrotate python-docutils pkg-config cmake nodejs git-core Install Ruby For production sites is a MUST install from sources without using any versions managers like RVM, RENV or whatever this is why leads to hard to diagnose problems." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://carakan.github.io/blog/install-passenger-5-ruby-2-x-nginx-1-10-x-and-enable-http2/" />
<meta property="article:published_time" content="2016-06-24T17:27:00&#43;00:00"/>
<meta property="article:modified_time" content="2016-06-24T17:27:00&#43;00:00"/>

<meta itemprop="name" content="install passenger 5, ruby 2.x, nginx 1.10.x and enable HTTP/2">
<meta itemprop="description" content="Recently I found that passenger in the last version now uses nginx 1.10.x by default, as you knows since nginx 1.9.x nginx enables support for http2 but the 1.9.x on nginx is beta and when released the line 1.10 is production ready. The process will be describe for ubuntu 14.4 and 16.4:
Install Dependencies apt-get update -y apt-get upgrade -y apt-get install sudo -y install the required packages:
sudo apt-get install -y build-essential zlib1g-dev libyaml-dev libssl-dev libgdbm-dev libreadline-dev libncurses5-dev libffi-dev curl openssh-server checkinstall libxml2-dev libxslt-dev libcurl4-openssl-dev libicu-dev logrotate python-docutils pkg-config cmake nodejs git-core Install Ruby For production sites is a MUST install from sources without using any versions managers like RVM, RENV or whatever this is why leads to hard to diagnose problems.">


<meta itemprop="datePublished" content="2016-06-24T17:27:00&#43;00:00" />
<meta itemprop="dateModified" content="2016-06-24T17:27:00&#43;00:00" />
<meta itemprop="wordCount" content="271">



<meta itemprop="keywords" content="devop,http2,passenger,ruby," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="install passenger 5, ruby 2.x, nginx 1.10.x and enable HTTP/2"/>
<meta name="twitter:description" content="Recently I found that passenger in the last version now uses nginx 1.10.x by default, as you knows since nginx 1.9.x nginx enables support for http2 but the 1.9.x on nginx is beta and when released the line 1.10 is production ready. The process will be describe for ubuntu 14.4 and 16.4:
Install Dependencies apt-get update -y apt-get upgrade -y apt-get install sudo -y install the required packages:
sudo apt-get install -y build-essential zlib1g-dev libyaml-dev libssl-dev libgdbm-dev libreadline-dev libncurses5-dev libffi-dev curl openssh-server checkinstall libxml2-dev libxslt-dev libcurl4-openssl-dev libicu-dev logrotate python-docutils pkg-config cmake nodejs git-core Install Ruby For production sites is a MUST install from sources without using any versions managers like RVM, RENV or whatever this is why leads to hard to diagnose problems."/>

  <!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->

  <!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
  <![endif]-->

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-5022449-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
</head>

  <body>
    
  <h1>install passenger 5, ruby 2.x, nginx 1.10.x and enable HTTP/2</h1>
  <header>
  
  <div class="avatar">
    <img class="avatarMask" src="https://carakan.github.io//img/avatar.jpg">
    <a href="https://carakan.github.io/"><img src="https://carakan.github.io//img/avatar-border.svg" }}></a>
  </div>
  
  <h2><a class="author" href="https://carakan.github.io/">Carlos Ramos</a></h2>
</header>

  
  
  <p class="date">June 24, 2016</p>
  
  <div id="contentBody">
    

<p>Recently I found that passenger in the last version now uses nginx 1.10.x by default, as you knows since nginx 1.9.x nginx enables support for <a href="https://en.wikipedia.org/wiki/HTTP/2">http2</a> but the 1.9.x on nginx is <em>beta</em> and when released the line 1.10 is production ready. The process will be describe for ubuntu 14.4 and 16.4:</p>

<h2 id="install-dependencies">Install Dependencies</h2>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">apt-get update -y
apt-get upgrade -y
apt-get install sudo -y</code></pre></div>
<p>install the required packages:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get install -y build-essential zlib1g-dev libyaml-dev libssl-dev libgdbm-dev libreadline-dev libncurses5-dev libffi-dev curl openssh-server checkinstall libxml2-dev libxslt-dev libcurl4-openssl-dev libicu-dev logrotate python-docutils pkg-config cmake nodejs git-core</code></pre></div>
<h2 id="install-ruby">Install Ruby</h2>

<p>For production sites is a <em>MUST</em> install from sources without using any versions managers like RVM, RENV or whatever this is why leads to hard to diagnose problems. Remove the old Ruby 1.8 if present:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get remove ruby1.8</code></pre></div>
<p>Download Ruby and compile it:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir /tmp/ruby <span style="color:#666">&amp;&amp;</span> <span style="color:#a2f">cd</span> /tmp/ruby
curl -O --progress https://cache.ruby-lang.org/pub/ruby/2.3/ruby-2.3.1.tar.gz
tar xzf ruby-2.3.1.tar.gz
<span style="color:#a2f">cd</span> ruby-2.3.1
./configure --disable-install-rdoc
make
sudo make install</code></pre></div>
<p>Install the passenger Gem:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo gem install passenger --no-ri --no-rdoc</code></pre></div>
<p>Now we need to install nginx manually, enable http2 and add the dependency to passenger:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir /tmp/nginx <span style="color:#666">&amp;&amp;</span> <span style="color:#a2f">cd</span> /tmp/nginx
curl -O --progress https://nginx.org/download/nginx-1.10.1.tar.gz
tar xzf nginx-1.10.1.tar.gz
<span style="color:#a2f">cd</span> nginx-1.10.1
<span style="color:#080;font-style:italic"># this contains all defaults options using the command passenger-install-nginx-module and http2 support</span>
./configure --prefix<span style="color:#666">=</span><span style="color:#b44">&#39;/opt/nginx&#39;</span> <span style="color:#b62;font-weight:bold">\\</span>
--with-http<span style="color:#b62;font-weight:bold">\_</span>ssl<span style="color:#b62;font-weight:bold">\_</span>module <span style="color:#b62;font-weight:bold">\\</span>
--with-http<span style="color:#b62;font-weight:bold">\_</span>gzip<span style="color:#b62;font-weight:bold">\_</span>static<span style="color:#b62;font-weight:bold">\_</span>module <span style="color:#b62;font-weight:bold">\\</span>
--with-http<span style="color:#b62;font-weight:bold">\_</span>stub<span style="color:#b62;font-weight:bold">\_</span>status<span style="color:#b62;font-weight:bold">\_</span>module <span style="color:#b62;font-weight:bold">\\</span>
--with-cc-opt<span style="color:#666">=</span>-Wno-error <span style="color:#b62;font-weight:bold">\\</span>
--with-ld-opt<span style="color:#666">=</span><span style="color:#b44">&#39;&#39;</span> <span style="color:#b62;font-weight:bold">\\</span>
--add-module<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">$(</span>passenger-config --nginx-addon-dir<span style="color:#a2f;font-weight:bold">)</span> <span style="color:#b62;font-weight:bold">\\</span>
--with-http<span style="color:#b62;font-weight:bold">\_</span>v2<span style="color:#b62;font-weight:bold">\_</span>module
make
sudo make install</code></pre></div>
<p>and thats it! you now have nginx + passenger + http2</p>

<h2 id="enable-http2-on-vhost">Enable http2 on vhost</h2>

<p><a href="https://http2.github.io/faq/#does-http2-require-encryption">only in https ;)</a></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">server <span style="color:#666">{</span>
             listen              <span style="color:#666">443</span> ssl **http2**;
             server<span style="color:#b62;font-weight:bold">\_</span>name         somedomain.com;
             ssl<span style="color:#b62;font-weight:bold">\_</span>certificate     path<span style="color:#b62;font-weight:bold">\_</span>to<span style="color:#b62;font-weight:bold">\_</span>your.crt;
             ssl<span style="color:#b62;font-weight:bold">\_</span>certificate<span style="color:#b62;font-weight:bold">\_</span>key path<span style="color:#b62;font-weight:bold">\_</span>to<span style="color:#b62;font-weight:bold">\_</span>your.key;
             root /path/to/your/rails/public;
             passenger<span style="color:#b62;font-weight:bold">\_</span>enabled on;
             passenger<span style="color:#b62;font-weight:bold">\_</span>set<span style="color:#b62;font-weight:bold">\_</span>header HTTP<span style="color:#b62;font-weight:bold">\_</span>X<span style="color:#b62;font-weight:bold">\_</span>FORWARDED<span style="color:#b62;font-weight:bold">\_</span>PROTO https;
         <span style="color:#666">}</span></code></pre></div>
  </div>
  <footer>
  <p>
  &copy; 2019 Carlos Ramos.
  Powered by <a href="https://gohugo.io/">Hugo</a>
  using the <a href="https://github.com/koirand/pulp/">pulp</a> theme.
  </p>
</footer>


  </body>
</html>
